# JSON Schema for BAS Simulation Configuration
# Validates all config files against expected structure and types

type: object
required:
  - system
  - room
  - pid_controller
  - crac_units
  - simulation

properties:
  system:
    type: object
    required: [name, version]
    properties:
      name:
        type: string
        description: "Human-readable system name"
      version:
        type: string
        pattern: "^\\d+\\.\\d+(\\.\\d+)?$"
        description: "Semantic version (e.g., '1.0.0')"
      description:
        type: string
        description: "Optional system description"

  room:
    type: object
    required: [initial_temp_c, thermal_mass_kj_per_c, it_load_kw]
    properties:
      initial_temp_c:
        type: number
        minimum: 10.0
        maximum: 40.0
        description: "Initial room temperature (°C)"
      ambient_temp_c:
        type: number
        minimum: 10.0
        maximum: 40.0
        default: 22.0
        description: "Ambient temperature (°C)"
      thermal_mass_kj_per_c:
        type: number
        minimum: 100.0
        maximum: 10000.0
        description: "Thermal mass (kJ/°C)"
      ua_kw_per_c:
        type: number
        minimum: 0.0
        maximum: 5.0
        default: 0.25
        description: "Envelope heat transfer coefficient (kW/°C)"
      it_load_kw:
        type: number
        minimum: 0.0
        maximum: 1000.0
        description: "IT server load (kW)"
      infil_ua_kw_per_c:
        type: number
        minimum: 0.0
        maximum: 2.0
        default: 0.0
        description: "Infiltration heat transfer coefficient (kW/°C)"
      n_virtual_sensors:
        type: integer
        minimum: 1
        maximum: 10
        default: 3
        description: "Number of virtual temperature sensors"

  pid_controller:
    type: object
    required: [kp, ki, kd]
    properties:
      kp:
        type: number
        minimum: 0.0
        maximum: 50.0
        description: "Proportional gain (%/°C)"
      ki:
        type: number
        minimum: 0.0
        maximum: 5.0
        description: "Integral gain (%/(°C·s))"
      kd:
        type: number
        minimum: 0.0
        maximum: 5.0
        description: "Derivative gain (%/(°C/s))"
      output_min:
        type: number
        minimum: 0.0
        maximum: 100.0
        default: 0.0
        description: "Minimum output (%)"
      output_max:
        type: number
        minimum: 0.0
        maximum: 100.0
        default: 100.0
        description: "Maximum output (%)"
      rate_limit:
        type: number
        minimum: 0.1
        maximum: 100.0
        default: 10.0
        description: "Maximum change rate (%/s)"
      integral_windup_limit:
        type: number
        minimum: 1.0
        maximum: 200.0
        default: 50.0
        description: "Integral windup protection limit (%)"

  crac_units:
    type: array
    minItems: 1
    maxItems: 10
    items:
      type: object
      required: [unit_id, q_rated_kw]
      properties:
        unit_id:
          type: string
          pattern: "^CRAC-\\d{2}$"
          description: "Unique CRAC unit identifier (e.g., 'CRAC-01')"
        q_rated_kw:
          type: number
          minimum: 1.0
          maximum: 200.0
          description: "Rated cooling capacity (kW)"
        efficiency_cop:
          type: number
          minimum: 1.0
          maximum: 10.0
          default: 3.5
          description: "Coefficient of performance"
        min_capacity_pct:
          type: number
          minimum: 0.0
          maximum: 50.0
          default: 20.0
          description: "Minimum capacity (%)"
        max_capacity_pct:
          type: number
          minimum: 50.0
          maximum: 100.0
          default: 100.0
          description: "Maximum capacity (%)"
        startup_time_s:
          type: number
          minimum: 1.0
          maximum: 600.0
          default: 180.0
          description: "Startup time (seconds)"
        shutdown_time_s:
          type: number
          minimum: 1.0
          maximum: 300.0
          default: 60.0
          description: "Shutdown time (seconds)"
        mtbf_hours:
          type: number
          minimum: 100.0
          maximum: 100000.0
          default: 8760.0
          description: "Mean time between failures (hours)"
        mttr_hours:
          type: number
          minimum: 1.0
          maximum: 100.0
          default: 4.0
          description: "Mean time to repair (hours)"

  staging_config:
    type: object
    properties:
      temp_error_threshold:
        type: number
        minimum: 0.1
        maximum: 5.0
        default: 0.8
        description: "Temperature error threshold for staging (°C)"
      staging_delay_s:
        type: number
        minimum: 30.0
        maximum: 600.0
        default: 180.0
        description: "Staging delay (seconds)"
      destaging_delay_s:
        type: number
        minimum: 60.0
        maximum: 1200.0
        default: 300.0
        description: "Destaging delay (seconds)"
      rotation_runtime_hours:
        type: number
        minimum: 1.0
        maximum: 168.0
        default: 24.0
        description: "Runtime before rotation (hours)"
      enable_rotation:
        type: boolean
        default: true
        description: "Enable automatic CRAC rotation"
      staging_hysteresis:
        type: number
        minimum: 0.1
        maximum: 1.0
        default: 0.2
        description: "Staging hysteresis (°C)"
      destaging_hysteresis:
        type: number
        minimum: 0.1
        maximum: 1.0
        default: 0.3
        description: "Destaging hysteresis (°C)"

  simulation:
    type: object
    required: [duration_minutes, timestep_s]
    properties:
      duration_minutes:
        type: number
        minimum: 1.0
        maximum: 1440.0
        description: "Simulation duration (minutes)"
      timestep_s:
        type: number
        minimum: 0.1
        maximum: 60.0
        default: 1.0
        description: "Simulation timestep (seconds)"
      output_interval_s:
        type: number
        minimum: 1.0
        maximum: 300.0
        default: 60.0
        description: "Data output interval (seconds)"
      setpoint_c:
        type: number
        minimum: 18.0
        maximum: 26.0
        default: 22.0
        description: "Temperature setpoint (°C)"
      random_seed:
        type: integer
        minimum: 1
        maximum: 999999
        description: "Random seed for reproducibility"

  alarms:
    type: object
    properties:
      enable_alarms:
        type: boolean
        default: true
        description: "Enable alarm system"
      high_temp_threshold_c:
        type: number
        minimum: 20.0
        maximum: 35.0
        default: 27.0
        description: "High temperature alarm threshold (°C)"
      low_temp_threshold_c:
        type: number
        minimum: 15.0
        maximum: 25.0
        default: 18.0
        description: "Low temperature alarm threshold (°C)"
      alarm_delay_s:
        type: number
        minimum: 30.0
        maximum: 300.0
        default: 120.0
        description: "Alarm activation delay (seconds)"

  telemetry:
    type: object
    properties:
      enable_csv_export:
        type: boolean
        default: true
        description: "Enable CSV data export"
      enable_real_time_display:
        type: boolean
        default: true
        description: "Enable real-time console output"
      csv_output_path:
        type: string
        default: "reports/"
        description: "CSV output directory path"
      data_retention_hours:
        type: number
        minimum: 1.0
        maximum: 168.0
        default: 24.0
        description: "Data retention period (hours)"

  bacnet:
    type: object
    properties:
      enabled:
        type: boolean
        default: false
        description: "Enable BACnet/IP interface"
      device:
        type: object
        required: [objectName, objectIdentifier]
        properties:
          objectName:
            type: string
            pattern: "^[A-Za-z0-9_-]+$"
            maxLength: 64
            description: "BACnet device object name"
          objectIdentifier:
            type: integer
            minimum: 1
            maximum: 4194303
            description: "BACnet device instance number (1-4194303)"
          vendorIdentifier:
            type: integer
            minimum: 0
            maximum: 65535
            default: 15
            description: "BACnet vendor identifier (15 = Other)"
          maxApduLengthAccepted:
            type: integer
            minimum: 50
            maximum: 1476
            default: 1024
            description: "Maximum APDU length accepted (bytes)"
          segmentationSupported:
            type: string
            enum: ["segmented-both", "segmented-transmit", "segmented-receive", "no-segmentation"]
            default: "segmented-both"
            description: "BACnet segmentation support level"
          modelName:
            type: string
            maxLength: 64
            default: "DC-BAS-Simulation"
            description: "Device model name"
          firmwareRevision:
            type: string
            maxLength: 32
            default: "1.0.0"
            description: "Firmware revision string"
          applicationSoftwareVersion:
            type: string
            maxLength: 32
            default: "1.0.0"
            description: "Application software version"
      network:
        type: object
        properties:
          bind:
            type: string
            format: ipv4
            default: "0.0.0.0"
            description: "IP address to bind to (0.0.0.0 for all interfaces)"
          port:
            type: integer
            minimum: 1024
            maximum: 65535
            default: 47808
            description: "UDP port for BACnet/IP communication"
          bbmdAddress:
            type: string
            format: ipv4
            description: "BBMD (BACnet Broadcast Management Device) IP address"
          bbmdPort:
            type: integer
            minimum: 1024
            maximum: 65535
            default: 47808
            description: "BBMD UDP port"
          foreignDeviceTtl:
            type: integer
            minimum: 1
            maximum: 65535
            default: 300
            description: "Foreign device registration TTL (seconds)"
      points:
        type: object
        properties:
          zone_temp_ai:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 1
            description: "Zone temperature analog input instance"
          zone_temp_setpoint_av:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 2
            description: "Zone temperature setpoint analog value instance"
          crac1_cmd_ao:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 3
            description: "CRAC-01 command analog output instance"
          crac1_status_bi:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 4
            description: "CRAC-01 status binary input instance"
          crac1_cooling_ai:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 5
            description: "CRAC-01 cooling output analog input instance"
          crac2_cmd_ao:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 6
            description: "CRAC-02 command analog output instance"
          crac2_status_bi:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 7
            description: "CRAC-02 status binary input instance"
          crac2_cooling_ai:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 8
            description: "CRAC-02 cooling output analog input instance"
          crac3_cmd_ao:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 9
            description: "CRAC-03 command analog output instance"
          crac3_status_bi:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 10
            description: "CRAC-03 status binary input instance"
          crac3_cooling_ai:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 11
            description: "CRAC-03 cooling output analog input instance"
          system_alarm_bo:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 12
            description: "System alarm binary output instance"
          it_load_ai:
            type: integer
            minimum: 1
            maximum: 4194303
            default: 13
            description: "IT load analog input instance"

  fault_simulation:
    type: object
    properties:
      enable_faults:
        type: boolean
        default: true
        description: "Enable fault simulation system"
      random_seed:
        type: integer
        minimum: 1
        maximum: 999999
        description: "Random seed for deterministic fault injection"
      sensor_faults:
        type: object
        properties:
          enable:
            type: boolean
            default: true
            description: "Enable sensor fault simulation"
          temperature_sensors:
            type: array
            items:
              type: object
              properties:
                sensor_id:
                  type: string
                  description: "Sensor identifier"
                location:
                  type: string
                  description: "Sensor location"
                enable_faults:
                  type: boolean
                  default: true
                  description: "Enable faults for this sensor"
                fault_types:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                        enum: ["drift", "bias", "intermittent", "noise", "stuck"]
                        description: "Type of fault to simulate"
                      probability:
                        type: number
                        minimum: 0.0
                        maximum: 1.0
                        description: "Fault probability per timestep"
                      drift_rate:
                        type: number
                        minimum: 0.0
                        description: "Drift rate (units/hour)"
                      max_drift:
                        type: number
                        minimum: 0.0
                        description: "Maximum total drift"
                      bias_offset:
                        type: number
                        description: "Systematic bias offset"
                      dropout_duration:
                        type: number
                        minimum: 0.0
                        description: "Average dropout duration (seconds)"
                      noise_amplitude:
                        type: number
                        minimum: 0.0
                        description: "RMS noise amplitude"
                      stuck_value:
                        type: ["number", "null"]
                        description: "Value to stick at (null = current)"
      actuator_faults:
        type: object
        properties:
          enable:
            type: boolean
            default: true
            description: "Enable actuator fault simulation"
          crac_dampers:
            type: array
            items:
              type: object
              properties:
                actuator_id:
                  type: string
                  description: "Actuator identifier"
                location:
                  type: string
                  description: "Actuator location"
                enable_faults:
                  type: boolean
                  default: true
                  description: "Enable faults for this actuator"
                fault_types:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                        enum: ["stiction", "backlash", "degradation", "oscillation", "partial_failure"]
                        description: "Type of actuator fault"
                      probability:
                        type: number
                        minimum: 0.0
                        maximum: 1.0
                        description: "Fault probability per timestep"
                      breakaway_threshold:
                        type: number
                        minimum: 0.0
                        description: "Minimum command change to overcome stiction"
                      static_friction:
                        type: number
                        minimum: 0.0
                        description: "Static friction resistance"
                      deadband:
                        type: number
                        minimum: 0.0
                        description: "Deadband percentage"
                      hysteresis_factor:
                        type: number
                        minimum: 0.0
                        description: "Hysteresis strength factor"
                      response_degradation:
                        type: number
                        minimum: 0.0
                        maximum: 1.0
                        description: "Response degradation factor"
                      accuracy_loss:
                        type: number
                        minimum: 0.0
                        description: "Position accuracy loss percentage"
                      amplitude:
                        type: number
                        minimum: 0.0
                        description: "Oscillation amplitude"
                      frequency:
                        type: number
                        minimum: 0.0
                        description: "Oscillation frequency (Hz)"
                      failure_rate:
                        type: number
                        minimum: 0.0
                        description: "Failure progression rate"
      control_faults:
        type: object
        properties:
          enable:
            type: boolean
            default: true
            description: "Enable control system fault simulation"
          pid_controller:
            type: object
            properties:
              enable_faults:
                type: boolean
                default: true
                description: "Enable PID controller faults"
              fault_types:
                type: array
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      enum: ["short_cycling", "controller_saturation", "communication_dropout", "loop_instability"]
                      description: "Type of control fault"
                    probability:
                      type: number
                      minimum: 0.0
                      maximum: 1.0
                      description: "Fault probability per timestep"
                    cycle_threshold:
                      type: number
                      minimum: 0.0
                      description: "Normal cycle time threshold (seconds)"
                    short_cycle_ratio:
                      type: number
                      minimum: 0.0
                      maximum: 1.0
                      description: "Short cycle ratio of normal"
                    saturation_threshold:
                      type: number
                      minimum: 0.0
                      maximum: 100.0
                      description: "Saturation threshold percentage"
                    saturation_duration:
                      type: number
                      minimum: 0.0
                      description: "Minimum saturation duration (seconds)"
                    dropout_duration:
                      type: number
                      minimum: 0.0
                      description: "Average dropout duration (seconds)"
                    max_dropout:
                      type: number
                      minimum: 0.0
                      description: "Maximum dropout duration (seconds)"
                    instability_gain:
                      type: number
                      minimum: 1.0
                      description: "Instability gain increase factor"
                    oscillation_period:
                      type: number
                      minimum: 0.0
                      description: "Oscillation period (seconds)"
      equipment_faults:
        type: object
        properties:
          enable:
            type: boolean
            default: true
            description: "Enable additional equipment faults"
          crac_units:
            type: array
            items:
              type: object
              properties:
                unit_id:
                  type: string
                  description: "CRAC unit identifier"
                additional_faults:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                        enum: ["performance_degradation", "efficiency_loss", "refrigerant_leak", "compressor_wear"]
                        description: "Equipment fault type"
                      probability:
                        type: number
                        minimum: 0.0
                        maximum: 1.0
                        description: "Fault probability per timestep"
                      degradation_rate:
                        type: number
                        minimum: 0.0
                        description: "Performance degradation rate"
                      max_degradation:
                        type: number
                        minimum: 0.0
                        maximum: 100.0
                        description: "Maximum degradation percentage"
                      efficiency_loss_rate:
                        type: number
                        minimum: 0.0
                        description: "Efficiency loss rate per hour"
                      leak_rate:
                        type: number
                        minimum: 0.0
                        description: "Leak rate (capacity loss per hour)"
                      wear_factor:
                        type: number
                        minimum: 1.0
                        description: "Wear factor (performance reduction)"

  diagnostics:
    type: object
    properties:
      enable:
        type: boolean
        default: true
        description: "Enable diagnostic system"
      engine:
        type: object
        properties:
          evaluation_interval_s:
            type: number
            minimum: 1.0
            maximum: 3600.0
            default: 60.0
            description: "Diagnostic evaluation interval (seconds)"
          confidence_threshold:
            type: number
            minimum: 0.0
            maximum: 1.0
            default: 0.7
            description: "Minimum confidence for fault confirmation"
          data_buffer_size:
            type: integer
            minimum: 100
            maximum: 10000
            default: 1000
            description: "Maximum data points to store"
          rules:
            type: object
            properties:
              sensor_drift_detection:
                type: object
                properties:
                  enable:
                    type: boolean
                    default: true
                    description: "Enable sensor drift detection"
                  evaluation_interval_s:
                    type: number
                    minimum: 1.0
                    maximum: 3600.0
                    description: "Evaluation interval (seconds)"
                  confirmation_time_s:
                    type: number
                    minimum: 1.0
                    maximum: 7200.0
                    description: "Confirmation time (seconds)"
                  drift_threshold:
                    type: number
                    minimum: 0.1
                    maximum: 10.0
                    description: "Drift threshold"
              equipment_performance:
                type: object
                properties:
                  enable:
                    type: boolean
                    default: true
                    description: "Enable equipment performance monitoring"
                  evaluation_interval_s:
                    type: number
                    minimum: 1.0
                    maximum: 3600.0
                    description: "Evaluation interval (seconds)"
                  confirmation_time_s:
                    type: number
                    minimum: 1.0
                    maximum: 7200.0
                    description: "Confirmation time (seconds)"
                  performance_threshold:
                    type: number
                    minimum: 0.0
                    maximum: 1.0
                    description: "Performance threshold ratio"
              control_instability:
                type: object
                properties:
                  enable:
                    type: boolean
                    default: true
                    description: "Enable control instability detection"
                  evaluation_interval_s:
                    type: number
                    minimum: 1.0
                    maximum: 3600.0
                    description: "Evaluation interval (seconds)"
                  confirmation_time_s:
                    type: number
                    minimum: 1.0
                    maximum: 7200.0
                    description: "Confirmation time (seconds)"
                  variability_threshold:
                    type: number
                    minimum: 1.0
                    maximum: 100.0
                    description: "Control signal variability threshold"
              energy_efficiency:
                type: object
                properties:
                  enable:
                    type: boolean
                    default: true
                    description: "Enable energy efficiency monitoring"
                  evaluation_interval_s:
                    type: number
                    minimum: 1.0
                    maximum: 3600.0
                    description: "Evaluation interval (seconds)"
                  confirmation_time_s:
                    type: number
                    minimum: 1.0
                    maximum: 7200.0
                    description: "Confirmation time (seconds)"
                  efficiency_threshold:
                    type: number
                    minimum: 0.0
                    maximum: 1.0
                    description: "Efficiency threshold ratio"
      root_cause:
        type: object
        properties:
          enable:
            type: boolean
            default: true
            description: "Enable root cause analysis"
          analysis_depth:
            type: string
            enum: ["summary", "standard", "detailed"]
            default: "standard"
            description: "Depth of root cause analysis"
          correlation_threshold:
            type: number
            minimum: 0.0
            maximum: 1.0
            default: 0.6
            description: "Minimum correlation for cause linkage"
          evidence_weight:
            type: number
            minimum: 0.0
            maximum: 10.0
            default: 1.0
            description: "Weight of supporting evidence"
      reporting:
        type: object
        properties:
          enable:
            type: boolean
            default: true
            description: "Enable diagnostic reporting"
          auto_generate:
            type: boolean
            default: true
            description: "Automatically generate reports"
          default_format:
            type: string
            enum: ["json", "csv", "markdown", "html"]
            default: "markdown"
            description: "Default report format"
          output_directory:
            type: string
            default: "reports/diagnostics/"
            description: "Report output directory"
          include_charts:
            type: boolean
            default: true
            description: "Include performance charts"
          include_raw_data:
            type: boolean
            default: false
            description: "Include raw diagnostic data"
          daily_summary:
            type: boolean
            default: true
            description: "Generate daily health summary"
          weekly_analysis:
            type: boolean
            default: true
            description: "Generate weekly trend analysis"
          fault_reports:
            type: boolean
            default: true
            description: "Generate immediate fault reports"
          audience:
            type: string
            enum: ["executive", "technical", "maintenance"]
            default: "technical"
            description: "Target audience for reports"
          detail_level:
            type: string
            enum: ["summary", "standard", "detailed"]
            default: "standard"
            description: "Level of detail in reports"
          company_name:
            type: string
            description: "Company name for reports"
          facility_name:
            type: string
            description: "Facility name for reports"

additionalProperties: false